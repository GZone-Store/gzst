<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>LINE Login Callback</title>
</head>
<body>
  <p>กำลังตรวจสอบข้อมูลล็อกอิน...</p>
  <script>
    // ดึงค่า code ที่ LINE ส่งกลับมา
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    const state = urlParams.get('state');

    if (code) {
      // ส่ง code ไปยัง backend ที่ Glitch เพื่อขอ access_token
      fetch('https://billowy-spiny-ski.glitch.me', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ code, state })
      })
      .then(response => response.json())
      .then(data => {
        if (data.name) {
          document.body.innerHTML = `<h2>ยินดีต้อนรับคุณ ${data.name}</h2><p>Email: ${data.email}</p>`;
        } else {
          document.body.innerHTML = `<p>เกิดข้อผิดพลาด: ${JSON.stringify(data)}</p>`;
        }
      })
      .catch(error => {
        document.body.innerHTML = `<p>ข้อผิดพลาดในการเชื่อมต่อกับเซิร์ฟเวอร์: ${error}</p>`;
      });
    } else {
      document.body.innerHTML = '<p>ไม่พบ code ที่ส่งมาจาก LINE</p>';
    }
  </script>
</body>
</html>
