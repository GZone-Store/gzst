<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>กำลังเข้าสู่ระบบด้วย LINE...</title>
</head>
<body>
  <h2>กำลังเข้าสู่ระบบด้วย LINE...</h2>
  <script>
    (async () => {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      const state = params.get("state");

      if (!code) {
        document.body.innerHTML = "<p>ไม่พบโค้ดจาก LINE</p>";
        return;
      }

      try {
        const res = await fetch("https://line-login-gzone.workers.dev", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code, state })
        });

        const data = await res.json();
        if (data.error) {
          document.body.innerHTML = `<p>เกิดข้อผิดพลาด: ${data.error}</p>`;
        } else {
          document.body.innerHTML = `
            <h3>ยินดีต้อนรับ, ${data.displayName}</h3>
            <img src="${data.pictureUrl}" width="100" />
            <p>อีเมล: ${data.email || "ไม่ได้รับสิทธิ์"}</p>
          `;
        }
      } catch (err) {
        document.body.innerHTML = `<p>เกิดข้อผิดพลาด: ${err.message}</p>`;
      }
    })();
  </script>
</body>
</html>
